{"version":3,"file":"tact-js.es5.js","sources":["../src/PlayerSocket.ts","../src/HapticPlayer.ts","../src/tact-js.ts"],"sourcesContent":["const DEFAULT_URL= 'ws://127.0.0.1:15881/v2/feedbacks?app_id=com.bhaptics.designer2&app_name=bHaptics Designer';\r\n\r\nexport enum STATUS {\r\n  CONNECTING = 'Connecting',\r\n  CONNECTED ='Connected',\r\n  DISCONNECT = 'Disconnected',\r\n}\r\n\r\nconst DEFAULT_RETRY_CONNECT_TIME = 5000;\r\n\r\nexport interface Message {\r\n  status: STATUS;\r\n  message: any;\r\n}\r\n\r\nexport default class PlayerSocket {\r\n  private handlers: Function[] = [];\r\n  private websocketClient: any;\r\n  private currentStatus: STATUS;\r\n  private message: any;\r\n  private isTriggered = false;\r\n\r\n  retryConnectTime: number;\r\n\r\n  constructor(retryConnectTime = DEFAULT_RETRY_CONNECT_TIME) {\r\n    this.message = {};\r\n    this.retryConnectTime = retryConnectTime;\r\n    this.currentStatus = STATUS.DISCONNECT;\r\n  }\r\n\r\n  public addListener = (func: (msg: Message) => void) => {\r\n    this.handlers.push(func);\r\n  };\r\n\r\n  private emit = (msg: Message) => {\r\n    this.handlers.forEach(func => {\r\n      func(msg);\r\n    })\r\n  };\r\n\r\n  connect = () => {\r\n    try  {\r\n      this.websocketClient = new WebSocket(DEFAULT_URL);\r\n    } catch (e) {\r\n      // connection failed\r\n      console.log('PlayerSocket', e);\r\n      return;\r\n    }\r\n\r\n    this.websocketClient.onopen = () => {\r\n      this.currentStatus = STATUS.CONNECTED;\r\n      this.emit( {\r\n        status: this.currentStatus,\r\n        message: this.message,\r\n      });\r\n    };\r\n\r\n    this.websocketClient.onmessage = (result: any) => {\r\n      if (JSON.stringify(this.message) === result.data) {\r\n        return;\r\n      }\r\n\r\n      this.message = JSON.parse(result.data);\r\n      this.emit({\r\n        status: this.currentStatus,\r\n        message: this.message,\r\n      });\r\n    };\r\n\r\n    this.websocketClient.onclose = (event: any) => {\r\n      this.currentStatus = STATUS.DISCONNECT;\r\n      this.emit( {\r\n        status: this.currentStatus,\r\n        message: this.message,\r\n      });\r\n      setTimeout(() => {\r\n        this.connect();\r\n      }, this.retryConnectTime);\r\n    };\r\n\r\n    this.currentStatus = STATUS.CONNECTING;\r\n    this.emit({\r\n      status: this.currentStatus,\r\n      message: this.message,\r\n    });\r\n  };\r\n\r\n  send = (message: string) => {\r\n    if (message === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (!this.isTriggered) {\r\n      this.isTriggered = true;\r\n      this.connect();\r\n      return;\r\n    }\r\n\r\n    if (this.websocketClient === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this.currentStatus !== STATUS.CONNECTED) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      this.websocketClient.send(message);\r\n    } catch (e) {\r\n      // sending failed\r\n    }\r\n  }\r\n}\r\n\r\n","\r\nimport PlayerSocket, {Message} from './PlayerSocket';\r\nimport { DotPoint, PathPoint, PositionType, RotationOption, ScaleOption } from './Interfaces'\r\n\r\nclass HapticPlayer {\r\n  socket: PlayerSocket;\r\n  constructor() {\r\n    this.socket = new PlayerSocket();\r\n  }\r\n\r\n  public addListener = (func: (msg: Message) => void) => {\r\n    this.socket.addListener(func);\r\n  };\r\n\r\n  public turnOff = (position: PositionType) => {\r\n    const request = {\r\n      Submit :[{\r\n        Type : 'turnOff',\r\n        Key : position,\r\n      }],\r\n    };\r\n    this.socket.send(JSON.stringify(request));\r\n  };\r\n\r\n  public turnOffAll = () => {\r\n    const request = {\r\n      Submit :[{\r\n        Type : 'turnOffAll',\r\n      }],\r\n    };\r\n    this.socket.send(JSON.stringify(request));\r\n  };\r\n\r\n  public submitDot = (key: string,\r\n                      pos: PositionType,\r\n                      dotPoints: DotPoint[],\r\n                      durationMillis: number) : void => {\r\n    const request = {\r\n      Submit :[{\r\n        Type : 'frame',\r\n        Key : key,\r\n        Frame : {\r\n          Position : pos,\r\n          PathPoints: [],\r\n          DotPoints : dotPoints,\r\n          DurationMillis : durationMillis,\r\n        },\r\n      }],\r\n    };\r\n    this.socket.send(JSON.stringify(request, (k, val) =>\r\n      val.toFixed ? Number(val.toFixed(3)) : val\r\n    ));\r\n  };\r\n\r\n  public submitPath = (key: string,\r\n                pos: PositionType,\r\n                pathPoints: PathPoint[],\r\n                durationMillis: number) => {\r\n    const request = {\r\n      Submit :[{\r\n        Type : 'frame',\r\n        Key : key,\r\n        Frame : {\r\n          Position : pos,\r\n          PathPoints : pathPoints,\r\n          DotPoints : [],\r\n          DurationMillis : durationMillis,\r\n        },\r\n      }],\r\n    };\r\n    this.socket.send(JSON.stringify(request, (k, val) =>\r\n      val.toFixed ? Number(val.toFixed(3)) : val\r\n    ));\r\n  }\r\n\r\n  public registerFile = (key: string, json: string) => {\r\n    const jsonData = JSON.parse(json);\r\n    const project = jsonData[\"project\"];\r\n    const request = {\r\n      Register: [{\r\n        Key: key,\r\n        project,\r\n      }]\r\n    };\r\n    this.socket.send(JSON.stringify(request));\r\n\r\n  }\r\n\r\n  public submitRegistered = (key: string) : void => {\r\n    const request = {\r\n      Submit :[{\r\n        Type : 'key',\r\n        Key : key,\r\n      }],\r\n    };\r\n\r\n    this.socket.send(JSON.stringify(request));\r\n  }\r\n\r\n  public submitRegisteredWithScaleOption = (key: string, scaleOption: ScaleOption) : void => {\r\n    const request = {\r\n      Submit :[{\r\n        Type : 'key',\r\n        Key : key,\r\n        Parameters : {\r\n          scaleOption,\r\n        }\r\n      }],\r\n    };\r\n\r\n    this.socket.send(JSON.stringify(request));\r\n  }\r\n\r\n  public submitRegisteredWithRotationOption = (key: string, rotationOption: RotationOption) : void => {\r\n    const request = {\r\n      Submit :[{\r\n        Type : 'key',\r\n        Key : key,\r\n        Parameters : {\r\n          rotationOption,\r\n        }\r\n      }],\r\n    };\r\n\r\n    this.socket.send(JSON.stringify(request));\r\n  }\r\n}\r\n\r\nexport default HapticPlayer;\r\n","import HapticPlayer from './HapticPlayer'\r\n\r\nconst tactJs = new HapticPlayer();\r\n\r\nexport default tactJs;\r\n"],"names":[],"mappings":"AAAA,IAAM,WAAW,GAAE,4FAA4F,CAAC;AAEhH,AAAA,IAAY,MAIX;AAJD,WAAY,MAAM;IAChB,mCAAyB,CAAA;IACzB,iCAAsB,CAAA;IACtB,qCAA2B,CAAA;CAC5B,EAJW,MAAM,KAAN,MAAM,QAIjB;AAED,IAAM,0BAA0B,GAAG,IAAI,CAAC;AAOxC;IASE,sBAAY,gBAA6C;QAAzD,iBAIC;QAJW,iCAAA,EAAA,6CAA6C;QARjD,aAAQ,GAAe,EAAE,CAAC;QAI1B,gBAAW,GAAG,KAAK,CAAC;QAUrB,gBAAW,GAAG,UAAC,IAA4B;YAChD,KAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;SAC1B,CAAC;QAEM,SAAI,GAAG,UAAC,GAAY;YAC1B,KAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,UAAA,IAAI;gBACxB,IAAI,CAAC,GAAG,CAAC,CAAC;aACX,CAAC,CAAA;SACH,CAAC;QAEF,YAAO,GAAG;YACR,IAAK;gBACH,KAAI,CAAC,eAAe,GAAG,IAAI,SAAS,CAAC,WAAW,CAAC,CAAC;aACnD;YAAC,OAAO,CAAC,EAAE;;gBAEV,OAAO,CAAC,GAAG,CAAC,cAAc,EAAE,CAAC,CAAC,CAAC;gBAC/B,OAAO;aACR;YAED,KAAI,CAAC,eAAe,CAAC,MAAM,GAAG;gBAC5B,KAAI,CAAC,aAAa,GAAG,MAAM,CAAC,SAAS,CAAC;gBACtC,KAAI,CAAC,IAAI,CAAE;oBACT,MAAM,EAAE,KAAI,CAAC,aAAa;oBAC1B,OAAO,EAAE,KAAI,CAAC,OAAO;iBACtB,CAAC,CAAC;aACJ,CAAC;YAEF,KAAI,CAAC,eAAe,CAAC,SAAS,GAAG,UAAC,MAAW;gBAC3C,IAAI,IAAI,CAAC,SAAS,CAAC,KAAI,CAAC,OAAO,CAAC,KAAK,MAAM,CAAC,IAAI,EAAE;oBAChD,OAAO;iBACR;gBAED,KAAI,CAAC,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;gBACvC,KAAI,CAAC,IAAI,CAAC;oBACR,MAAM,EAAE,KAAI,CAAC,aAAa;oBAC1B,OAAO,EAAE,KAAI,CAAC,OAAO;iBACtB,CAAC,CAAC;aACJ,CAAC;YAEF,KAAI,CAAC,eAAe,CAAC,OAAO,GAAG,UAAC,KAAU;gBACxC,KAAI,CAAC,aAAa,GAAG,MAAM,CAAC,UAAU,CAAC;gBACvC,KAAI,CAAC,IAAI,CAAE;oBACT,MAAM,EAAE,KAAI,CAAC,aAAa;oBAC1B,OAAO,EAAE,KAAI,CAAC,OAAO;iBACtB,CAAC,CAAC;gBACH,UAAU,CAAC;oBACT,KAAI,CAAC,OAAO,EAAE,CAAC;iBAChB,EAAE,KAAI,CAAC,gBAAgB,CAAC,CAAC;aAC3B,CAAC;YAEF,KAAI,CAAC,aAAa,GAAG,MAAM,CAAC,UAAU,CAAC;YACvC,KAAI,CAAC,IAAI,CAAC;gBACR,MAAM,EAAE,KAAI,CAAC,aAAa;gBAC1B,OAAO,EAAE,KAAI,CAAC,OAAO;aACtB,CAAC,CAAC;SACJ,CAAC;QAEF,SAAI,GAAG,UAAC,OAAe;YACrB,IAAI,OAAO,KAAK,SAAS,EAAE;gBACzB,OAAO;aACR;YAED,IAAI,CAAC,KAAI,CAAC,WAAW,EAAE;gBACrB,KAAI,CAAC,WAAW,GAAG,IAAI,CAAC;gBACxB,KAAI,CAAC,OAAO,EAAE,CAAC;gBACf,OAAO;aACR;YAED,IAAI,KAAI,CAAC,eAAe,KAAK,SAAS,EAAE;gBACtC,OAAO;aACR;YAED,IAAI,KAAI,CAAC,aAAa,KAAK,MAAM,CAAC,SAAS,EAAE;gBAC3C,OAAO;aACR;YAED,IAAI;gBACF,KAAI,CAAC,eAAe,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;aACpC;YAAC,OAAO,CAAC,EAAE;;aAEX;SACF,CAAA;QAtFC,IAAI,CAAC,OAAO,GAAG,EAAE,CAAC;QAClB,IAAI,CAAC,gBAAgB,GAAG,gBAAgB,CAAC;QACzC,IAAI,CAAC,aAAa,GAAG,MAAM,CAAC,UAAU,CAAC;KACxC;IAoFH,mBAAC;CAAA,IAAA;;AC5GD;IAEE;QAAA,iBAEC;QAEM,gBAAW,GAAG,UAAC,IAA4B;YAChD,KAAI,CAAC,MAAM,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;SAC/B,CAAC;QAEK,YAAO,GAAG,UAAC,QAAsB;YACtC,IAAM,OAAO,GAAG;gBACd,MAAM,EAAE,CAAC;wBACP,IAAI,EAAG,SAAS;wBAChB,GAAG,EAAG,QAAQ;qBACf,CAAC;aACH,CAAC;YACF,KAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC;SAC3C,CAAC;QAEK,eAAU,GAAG;YAClB,IAAM,OAAO,GAAG;gBACd,MAAM,EAAE,CAAC;wBACP,IAAI,EAAG,YAAY;qBACpB,CAAC;aACH,CAAC;YACF,KAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC;SAC3C,CAAC;QAEK,cAAS,GAAG,UAAC,GAAW,EACX,GAAiB,EACjB,SAAqB,EACrB,cAAsB;YACxC,IAAM,OAAO,GAAG;gBACd,MAAM,EAAE,CAAC;wBACP,IAAI,EAAG,OAAO;wBACd,GAAG,EAAG,GAAG;wBACT,KAAK,EAAG;4BACN,QAAQ,EAAG,GAAG;4BACd,UAAU,EAAE,EAAE;4BACd,SAAS,EAAG,SAAS;4BACrB,cAAc,EAAG,cAAc;yBAChC;qBACF,CAAC;aACH,CAAC;YACF,KAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,UAAC,CAAC,EAAE,GAAG;gBAC9C,OAAA,GAAG,CAAC,OAAO,GAAG,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,GAAG,GAAG;aAAA,CAC3C,CAAC,CAAC;SACJ,CAAC;QAEK,eAAU,GAAG,UAAC,GAAW,EAClB,GAAiB,EACjB,UAAuB,EACvB,cAAsB;YAClC,IAAM,OAAO,GAAG;gBACd,MAAM,EAAE,CAAC;wBACP,IAAI,EAAG,OAAO;wBACd,GAAG,EAAG,GAAG;wBACT,KAAK,EAAG;4BACN,QAAQ,EAAG,GAAG;4BACd,UAAU,EAAG,UAAU;4BACvB,SAAS,EAAG,EAAE;4BACd,cAAc,EAAG,cAAc;yBAChC;qBACF,CAAC;aACH,CAAC;YACF,KAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,UAAC,CAAC,EAAE,GAAG;gBAC9C,OAAA,GAAG,CAAC,OAAO,GAAG,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,GAAG,GAAG;aAAA,CAC3C,CAAC,CAAC;SACJ,CAAA;QAEM,iBAAY,GAAG,UAAC,GAAW,EAAE,IAAY;YAC9C,IAAM,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;YAClC,IAAM,OAAO,GAAG,QAAQ,CAAC,SAAS,CAAC,CAAC;YACpC,IAAM,OAAO,GAAG;gBACd,QAAQ,EAAE,CAAC;wBACT,GAAG,EAAE,GAAG;wBACR,OAAO,SAAA;qBACR,CAAC;aACH,CAAC;YACF,KAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC;SAE3C,CAAA;QAEM,qBAAgB,GAAG,UAAC,GAAW;YACpC,IAAM,OAAO,GAAG;gBACd,MAAM,EAAE,CAAC;wBACP,IAAI,EAAG,KAAK;wBACZ,GAAG,EAAG,GAAG;qBACV,CAAC;aACH,CAAC;YAEF,KAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC;SAC3C,CAAA;QAEM,oCAA+B,GAAG,UAAC,GAAW,EAAE,WAAwB;YAC7E,IAAM,OAAO,GAAG;gBACd,MAAM,EAAE,CAAC;wBACP,IAAI,EAAG,KAAK;wBACZ,GAAG,EAAG,GAAG;wBACT,UAAU,EAAG;4BACX,WAAW,aAAA;yBACZ;qBACF,CAAC;aACH,CAAC;YAEF,KAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC;SAC3C,CAAA;QAEM,uCAAkC,GAAG,UAAC,GAAW,EAAE,cAA8B;YACtF,IAAM,OAAO,GAAG;gBACd,MAAM,EAAE,CAAC;wBACP,IAAI,EAAG,KAAK;wBACZ,GAAG,EAAG,GAAG;wBACT,UAAU,EAAG;4BACX,cAAc,gBAAA;yBACf;qBACF,CAAC;aACH,CAAC;YAEF,KAAI,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC;SAC3C,CAAA;QAtHC,IAAI,CAAC,MAAM,GAAG,IAAI,YAAY,EAAE,CAAC;KAClC;IAsHH,mBAAC;CAAA,IAAA;;AC5HD,IAAM,MAAM,GAAG,IAAI,YAAY,EAAE,CAAC;;;;"}