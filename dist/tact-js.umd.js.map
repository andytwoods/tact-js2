{"version":3,"file":"tact-js.umd.js","sources":["../src/PlayerSocket.ts","../src/HapticPlayer.ts","../src/tact-js.ts"],"sourcesContent":["const DEFAULT_URL= 'ws://127.0.0.1:15881/v2/feedbacks?app_id=com.bhaptics.designer2&app_name=bHaptics Designer';\r\n\r\nexport enum STATUS {\r\n  CONNECTING = 'Connecting',\r\n  CONNECTED ='Connected',\r\n  DISCONNECT = 'Disconnected',\r\n}\r\n\r\nconst DEFAULT_RETRY_CONNECT_TIME = 5000;\r\n\r\nexport interface Message {\r\n  status: STATUS;\r\n  message: any;\r\n}\r\n\r\nexport default class PlayerSocket {\r\n  private handlers: Function[] = [];\r\n  private websocketClient: any;\r\n  private currentStatus: STATUS;\r\n  private message: any;\r\n  private isTriggered = false;\r\n\r\n  retryConnectTime: number;\r\n\r\n  constructor(retryConnectTime = DEFAULT_RETRY_CONNECT_TIME) {\r\n    this.message = {};\r\n    this.retryConnectTime = retryConnectTime;\r\n    this.currentStatus = STATUS.DISCONNECT;\r\n  }\r\n\r\n  public addListener = (func: (msg: Message) => void) => {\r\n    this.handlers.push(func);\r\n  };\r\n\r\n  private emit = (msg: Message) => {\r\n    this.handlers.forEach(func => {\r\n      func(msg);\r\n    })\r\n  };\r\n\r\n  connect = () => {\r\n    try  {\r\n      this.websocketClient = new WebSocket(DEFAULT_URL);\r\n    } catch (e) {\r\n      // connection failed\r\n      console.log('PlayerSocket', e);\r\n      return;\r\n    }\r\n\r\n    this.websocketClient.onopen = () => {\r\n      this.currentStatus = STATUS.CONNECTED;\r\n      this.emit( {\r\n        status: this.currentStatus,\r\n        message: this.message,\r\n      });\r\n    };\r\n\r\n    this.websocketClient.onmessage = (result: any) => {\r\n      if (JSON.stringify(this.message) === result.data) {\r\n        return;\r\n      }\r\n\r\n      this.message = JSON.parse(result.data);\r\n      this.emit({\r\n        status: this.currentStatus,\r\n        message: this.message,\r\n      });\r\n    };\r\n\r\n    this.websocketClient.onclose = (event: any) => {\r\n      this.currentStatus = STATUS.DISCONNECT;\r\n      this.emit( {\r\n        status: this.currentStatus,\r\n        message: this.message,\r\n      });\r\n      setTimeout(() => {\r\n        this.connect();\r\n      }, this.retryConnectTime);\r\n    };\r\n\r\n    this.currentStatus = STATUS.CONNECTING;\r\n    this.emit({\r\n      status: this.currentStatus,\r\n      message: this.message,\r\n    });\r\n  };\r\n\r\n  send = (message: string) => {\r\n    if (message === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (!this.isTriggered) {\r\n      this.isTriggered = true;\r\n      this.connect();\r\n      return;\r\n    }\r\n\r\n    if (this.websocketClient === undefined) {\r\n      return;\r\n    }\r\n\r\n    if (this.currentStatus !== STATUS.CONNECTED) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      this.websocketClient.send(message);\r\n    } catch (e) {\r\n      // sending failed\r\n    }\r\n  }\r\n}\r\n\r\n","\r\nimport PlayerSocket, {Message} from './PlayerSocket';\r\nimport { DotPoint, PathPoint, PositionType, RotationOption, ScaleOption } from './Interfaces'\r\n\r\nclass HapticPlayer {\r\n  socket: PlayerSocket;\r\n  constructor() {\r\n    this.socket = new PlayerSocket();\r\n  }\r\n\r\n  public addListener = (func: (msg: Message) => void) => {\r\n    this.socket.addListener(func);\r\n  };\r\n\r\n  public turnOff = (position: PositionType) => {\r\n    const request = {\r\n      Submit :[{\r\n        Type : 'turnOff',\r\n        Key : position,\r\n      }],\r\n    };\r\n    this.socket.send(JSON.stringify(request));\r\n  };\r\n\r\n  public turnOffAll = () => {\r\n    const request = {\r\n      Submit :[{\r\n        Type : 'turnOffAll',\r\n      }],\r\n    };\r\n    this.socket.send(JSON.stringify(request));\r\n  };\r\n\r\n  public submitDot = (key: string,\r\n                      pos: PositionType,\r\n                      dotPoints: DotPoint[],\r\n                      durationMillis: number) : void => {\r\n    const request = {\r\n      Submit :[{\r\n        Type : 'frame',\r\n        Key : key,\r\n        Frame : {\r\n          Position : pos,\r\n          PathPoints: [],\r\n          DotPoints : dotPoints,\r\n          DurationMillis : durationMillis,\r\n        },\r\n      }],\r\n    };\r\n    this.socket.send(JSON.stringify(request, (k, val) =>\r\n      val.toFixed ? Number(val.toFixed(3)) : val\r\n    ));\r\n  };\r\n\r\n  public submitPath = (key: string,\r\n                pos: PositionType,\r\n                pathPoints: PathPoint[],\r\n                durationMillis: number) => {\r\n    const request = {\r\n      Submit :[{\r\n        Type : 'frame',\r\n        Key : key,\r\n        Frame : {\r\n          Position : pos,\r\n          PathPoints : pathPoints,\r\n          DotPoints : [],\r\n          DurationMillis : durationMillis,\r\n        },\r\n      }],\r\n    };\r\n    this.socket.send(JSON.stringify(request, (k, val) =>\r\n      val.toFixed ? Number(val.toFixed(3)) : val\r\n    ));\r\n  }\r\n\r\n  public registerFile = (key: string, json: string) => {\r\n    const jsonData = JSON.parse(json);\r\n    const project = jsonData[\"project\"];\r\n    const request = {\r\n      Register: [{\r\n        Key: key,\r\n        project,\r\n      }]\r\n    };\r\n    this.socket.send(JSON.stringify(request));\r\n\r\n  }\r\n\r\n  public submitRegistered = (key: string) : void => {\r\n    const request = {\r\n      Submit :[{\r\n        Type : 'key',\r\n        Key : key,\r\n      }],\r\n    };\r\n\r\n    this.socket.send(JSON.stringify(request));\r\n  }\r\n\r\n  public submitRegisteredWithScaleOption = (key: string, scaleOption: ScaleOption) : void => {\r\n    const request = {\r\n      Submit :[{\r\n        Type : 'key',\r\n        Key : key,\r\n        Parameters : {\r\n          scaleOption,\r\n        }\r\n      }],\r\n    };\r\n\r\n    this.socket.send(JSON.stringify(request));\r\n  }\r\n\r\n  public submitRegisteredWithRotationOption = (key: string, rotationOption: RotationOption) : void => {\r\n    const request = {\r\n      Submit :[{\r\n        Type : 'key',\r\n        Key : key,\r\n        Parameters : {\r\n          rotationOption,\r\n        }\r\n      }],\r\n    };\r\n\r\n    this.socket.send(JSON.stringify(request));\r\n  }\r\n}\r\n\r\nexport default HapticPlayer;\r\n","import HapticPlayer from './HapticPlayer'\r\n\r\nconst tactJs = new HapticPlayer();\r\n\r\nexport default tactJs;\r\n"],"names":[],"mappings":"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"}